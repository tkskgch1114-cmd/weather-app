<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©æ°—äºˆå ±ã‚¢ãƒ—ãƒª - Enhanced Version</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-bg: linear-gradient(135deg, #74b9ff, #0984e3);
            --dark-bg: linear-gradient(135deg, #2d3436, #636e72);
            --card-light: rgba(255, 255, 255, 0.15);
            --card-dark: rgba(0, 0, 0, 0.3);
            --text-light: white;
            --text-dark: #2d3436;
            --accent-color: #00b894;
            --accent-hover: #00a085;
            --warning-color: #fdcb6e;
            --danger-color: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--primary-bg);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: var(--dark-bg);
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 30px;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            right: 0;
            top: 0;
            background: var(--card-light);
            backdrop-filter: blur(10px);
            border: none;
            border-radius: 50px;
            padding: 10px 15px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .theme-toggle:hover {
            background: var(--card-dark);
            transform: scale(1.05);
        }

        .demo-notice {
            background: var(--card-light);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: var(--text-light);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .demo-notice h3 {
            margin-bottom: 10px;
            color: var(--warning-color);
        }

        .card {
            background: var(--card-light);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        }

        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        input[type="text"] {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-light);
            font-size: 16px;
            outline: none;
            min-width: 200px;
        }

        input[type="text"]::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        button {
            padding: 15px 25px;
            border: none;
            border-radius: 25px;
            background: var(--accent-color);
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        button:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }

        button.secondary {
            background: rgba(255, 255, 255, 0.2);
        }

        button.secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .favorites-container {
            margin: 20px 0;
        }

        .favorites-list {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .favorite-item {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .favorite-item:hover {
            background: var(--accent-color);
            transform: translateY(-2px);
        }

        .favorite-remove {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        .favorite-item:hover .favorite-remove {
            display: block;
        }

        .current-weather {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 30px;
        }

        .weather-icon {
            font-size: 80px;
            margin: 20px 0;
        }

        .temperature {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .detail-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .chart-container {
            background: var(--card-light);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chart-canvas {
            max-height: 300px;
        }

        .forecast-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .forecast-item {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            color: var(--text-light);
            transition: transform 0.3s ease;
        }

        .forecast-item:hover {
            transform: translateY(-5px);
        }

        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 300px;
        }

        .notification {
            background: var(--accent-color);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease-out;
            cursor: pointer;
        }

        .notification.warning {
            background: var(--warning-color);
        }

        .notification.danger {
            background: var(--danger-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading {
            text-align: center;
            color: var(--text-light);
            font-size: 18px;
        }

        .error {
            background: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }

        .github-link {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--card-light);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            padding: 10px 20px;
            color: var(--text-light);
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .github-link:hover {
            background: var(--card-dark);
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .temperature {
                font-size: 36px;
            }
            
            .weather-icon {
                font-size: 60px;
            }
            
            .github-link {
                position: static;
                display: block;
                text-align: center;
                margin: 20px 0;
            }

            .theme-toggle {
                position: static;
                margin-bottom: 20px;
            }

            .search-container {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }

        /* Dark mode adjustments */
        body.dark-mode .demo-notice,
        body.dark-mode .card,
        body.dark-mode .chart-container {
            background: var(--card-dark);
            color: var(--text-light);
        }

        body.dark-mode input[type="text"] {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
        }
    </style>
</head>
<body>
    <a href="#" class="github-link">ğŸ“‚ GitHub Repository</a>
    
    <div class="notification-container" id="notificationContainer"></div>
    
    <div class="container">
        <div class="header">
            <button class="theme-toggle" onclick="toggleTheme()">ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</button>
            <h1>ğŸŒ¤ï¸ å¤©æ°—äºˆå ±ã‚¢ãƒ—ãƒª</h1>
            <p>Enhanced Portfolio Version</p>
        </div>

        <div class="demo-notice">
            <h3>ğŸ¯ æ©Ÿèƒ½å¼·åŒ–ç‰ˆ ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ª</h3>
            <p><strong>æ–°æ©Ÿèƒ½ï¼š</strong> ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã€ãŠæ°—ã«å…¥ã‚Šéƒ½å¸‚ã€æ°—æ¸©ãƒãƒ£ãƒ¼ãƒˆã€å¤©æ°—ã‚¢ãƒ©ãƒ¼ãƒˆ</p>
            <p><strong>æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ï¼š</strong> HTML5, CSS3, JavaScript (ES6+), Chart.js, LocalStorage API, Notifications API</p>
        </div>

        <div class="card">
            <div class="search-container">
                <input type="text" id="cityInput" placeholder="éƒ½å¸‚åã‚’å…¥åŠ› (ä¾‹: Tokyo, Osaka)" />
                <button onclick="searchWeather()">ğŸ” æ¤œç´¢</button>
                <button onclick="getCurrentLocation()">ğŸ“ ç¾åœ¨åœ°</button>
                <button class="secondary" onclick="addToFavorites()">â­ ãŠæ°—ã«å…¥ã‚Šè¿½åŠ </button>
            </div>

            <div class="favorites-container">
                <h4 style="color: white; margin-bottom: 10px;">â­ ãŠæ°—ã«å…¥ã‚Šéƒ½å¸‚</h4>
                <div class="favorites-list" id="favoritesList"></div>
            </div>

            <div id="weatherDisplay">
                <div class="current-weather">
                    <h2>æ±äº¬, æ—¥æœ¬</h2>
                    <div class="weather-icon">â˜€ï¸</div>
                    <div class="temperature">22Â°C</div>
                    <p>æ™´ã‚Œ - ä½“æ„Ÿæ¸©åº¦ 24Â°C</p>
                    
                    <div class="weather-details">
                        <div class="detail-item">
                            <h4>ğŸ’§ æ¹¿åº¦</h4>
                            <p>65%</p>
                        </div>
                        <div class="detail-item">
                            <h4>ğŸ’¨ é¢¨é€Ÿ</h4>
                            <p>3.2 m/s</p>
                        </div>
                        <div class="detail-item">
                            <h4>ğŸˆ æ°—åœ§</h4>
                            <p>1013 hPa</p>
                        </div>
                        <div class="detail-item">
                            <h4>ğŸ‘ï¸ è¦–ç•Œ</h4>
                            <p>10 km</p>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 style="color: white; margin-bottom: 20px;">ğŸ“Š æ°—æ¸©æ¨ç§»ã‚°ãƒ©ãƒ•</h3>
                    <canvas id="temperatureChart" class="chart-canvas"></canvas>
                </div>

                <div class="card">
                    <h3 style="color: white; margin-bottom: 20px;">ğŸ“… 5æ—¥é–“ã®äºˆå ±</h3>
                    <div class="forecast-container" id="forecastDisplay">
                        <div class="forecast-item">
                            <h4>ä»Šæ—¥</h4>
                            <div style="font-size: 40px; margin: 10px 0;">â˜€ï¸</div>
                            <p>æ™´ã‚Œ</p>
                            <p><strong>22Â° / 15Â°</strong></p>
                        </div>
                        <div class="forecast-item">
                            <h4>æ˜æ—¥</h4>
                            <div style="font-size: 40px; margin: 10px 0;">â›…</div>
                            <p>æ›‡ã‚Šæ™‚ã€…æ™´ã‚Œ</p>
                            <p><strong>20Â° / 13Â°</strong></p>
                        </div>
                        <div class="forecast-item">
                            <h4>9/2</h4>
                            <div style="font-size: 40px; margin: 10px 0;">ğŸŒ§ï¸</div>
                            <p>é›¨</p>
                            <p><strong>18Â° / 11Â°</strong></p>
                        </div>
                        <div class="forecast-item">
                            <h4>9/3</h4>
                            <div style="font-size: 40px; margin: 10px 0;">â›ˆï¸</div>
                            <p>é›·é›¨</p>
                            <p><strong>16Â° / 9Â°</strong></p>
                        </div>
                        <div class="forecast-item">
                            <h4>9/4</h4>
                            <div style="font-size: 40px; margin: 10px 0;">â˜€ï¸</div>
                            <p>æ™´ã‚Œ</p>
                            <p><strong>24Â° / 16Â°</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURATION =====
        const DEMO_MODE = true;
        const API_KEY = 'DEMO_MODE';
        
        // Global state
        let currentWeatherData = null;
        let temperatureChart = null;
        let isDarkMode = false;

        // Demo data
        const demoData = {
            tokyo: {
                name: 'æ±äº¬', country: 'JP', temp: 22, feels_like: 24, humidity: 65,
                wind_speed: 3.2, pressure: 1013, visibility: 10, weather: 'æ™´ã‚Œ', icon: 'â˜€ï¸'
            },
            osaka: {
                name: 'å¤§é˜ª', country: 'JP', temp: 25, feels_like: 27, humidity: 70,
                wind_speed: 2.8, pressure: 1015, visibility: 8, weather: 'æ›‡ã‚Š', icon: 'â›…'
            },
            london: {
                name: 'ãƒ­ãƒ³ãƒ‰ãƒ³', country: 'GB', temp: 15, feels_like: 13, humidity: 85,
                wind_speed: 4.5, pressure: 1008, visibility: 5, weather: 'é›¨', icon: 'ğŸŒ§ï¸'
            },
            newyork: {
                name: 'ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯', country: 'US', temp: 18, feels_like: 20, humidity: 72,
                wind_speed: 3.8, pressure: 1012, visibility: 9, weather: 'æ›‡ã‚Š', icon: 'â˜ï¸'
            }
        };

        // ===== THEME TOGGLE =====
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            
            const themeToggle = document.querySelector('.theme-toggle');
            themeToggle.textContent = isDarkMode ? 'â˜€ï¸ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰' : 'ğŸŒ™ ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰';
            
            // Save theme preference
            localStorage.setItem('darkMode', isDarkMode);
            
            // Update chart if exists
            if (temperatureChart) {
                updateChartTheme();
            }
            
            showNotification('ãƒ†ãƒ¼ãƒã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ', 'info');
        }

        // ===== FAVORITES MANAGEMENT =====
        function loadFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favoriteCities') || '[]');
            displayFavorites(favorites);
        }

        function saveFavorites(favorites) {
            localStorage.setItem('favoriteCities', JSON.stringify(favorites));
        }

        function addToFavorites() {
            if (!currentWeatherData) {
                showNotification('å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã‹ã‚‰ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            const favorites = JSON.parse(localStorage.getItem('favoriteCities') || '[]');
            const cityName = currentWeatherData.name;
            
            if (favorites.includes(cityName)) {
                showNotification(`${cityName}ã¯æ—¢ã«ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã•ã‚Œã¦ã„ã¾ã™`, 'warning');
                return;
            }

            favorites.push(cityName);
            saveFavorites(favorites);
            displayFavorites(favorites);
            showNotification(`${cityName}ã‚’ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã—ã¾ã—ãŸ`, 'info');
        }

        function removeFromFavorites(cityName) {
            const favorites = JSON.parse(localStorage.getItem('favoriteCities') || '[]');
            const updatedFavorites = favorites.filter(city => city !== cityName);
            saveFavorites(updatedFavorites);
            displayFavorites(updatedFavorites);
            showNotification(`${cityName}ã‚’ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸ`, 'info');
        }

        function displayFavorites(favorites) {
            const favoritesList = document.getElementById('favoritesList');
            
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p style="color: rgba(255,255,255,0.7); font-size: 14px;">ãŠæ°—ã«å…¥ã‚Šã®éƒ½å¸‚ã¯ã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            favoritesList.innerHTML = favorites.map(city => `
                <div class="favorite-item" onclick="searchFavoriteCity('${city}')">
                    ${city}
                    <button class="favorite-remove" onclick="event.stopPropagation(); removeFromFavorites('${city}')">Ã—</button>
                </div>
            `).join('');
        }

        function searchFavoriteCity(cityName) {
            document.getElementById('cityInput').value = cityName;
            searchWeather();
        }

        // ===== NOTIFICATIONS =====
        function showNotification(message, type = 'info', duration = 3000) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${message}</span>
                    <span style="cursor: pointer; font-weight: bold;" onclick="this.parentElement.parentElement.remove()">Ã—</span>
                </div>
            `;
            
            container.appendChild(notification);
            
            // Auto remove
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, duration);

            // Request notification permission
            if (Notification.permission === 'default') {
                Notification.requestPermission();
            }

            // Show browser notification for weather alerts
            if (type === 'danger' && Notification.permission === 'granted') {
                new Notification('å¤©æ°—ã‚¢ãƒ©ãƒ¼ãƒˆ', {
                    body: message,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>'
                });
            }
        }

        // ===== WEATHER ALERTS =====
        function checkWeatherAlerts(weatherData) {
            const temp = weatherData.temp;
            const weather = weatherData.weather.toLowerCase();
            
            if (temp > 35) {
                showNotification(`âš ï¸ çŒ›æš‘è­¦å ±: ${temp}Â°C - ç†±ä¸­ç—‡ã«ã”æ³¨æ„ãã ã•ã„`, 'danger');
            } else if (temp < 0) {
                showNotification(`â„ï¸ ä½æ¸©è­¦å ±: ${temp}Â°C - é˜²å¯’å¯¾ç­–ã‚’ã—ã¦ãã ã•ã„`, 'danger');
            }
            
            if (weather.includes('é›·') || weather.includes('storm')) {
                showNotification('â›ˆï¸ é›·é›¨è­¦å ±: å¤–å‡ºæ™‚ã¯ã”æ³¨æ„ãã ã•ã„', 'danger');
            } else if (weather.includes('é›¨') || weather.includes('rain')) {
                showNotification('ğŸŒ§ï¸ é™é›¨æƒ…å ±: å‚˜ã‚’ãŠå¿˜ã‚Œãªã', 'warning');
            }
            
            if (weatherData.wind_speed > 10) {
                showNotification(`ğŸ’¨ å¼·é¢¨è­¦å ±: é¢¨é€Ÿ${weatherData.wind_speed}m/s`, 'warning');
            }
        }

        // ===== TEMPERATURE CHART =====
        function createTemperatureChart(data) {
            const ctx = document.getElementById('temperatureChart').getContext('2d');
            
            if (temperatureChart) {
                temperatureChart.destroy();
            }

            const chartData = {
                labels: ['6æ™‚', '9æ™‚', '12æ™‚', '15æ™‚', '18æ™‚', '21æ™‚', '24æ™‚'],
                datasets: [{
                    label: 'æ°—æ¸© (Â°C)',
                    data: data,
                    borderColor: '#74b9ff',
                    backgroundColor: 'rgba(116, 185, 255, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#0984e3',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 6
                }]
            };

            temperatureChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: isDarkMode ? '#ffffff' : '#ffffff'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: isDarkMode ? '#ffffff' : '#ffffff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.2)'
                            }
                        },
                        y: {
                            ticks: {
                                color: isDarkMode ? '#ffffff' : '#ffffff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.2)'
                            }
                        }
                    }
                }
            });
        }

        function updateChartTheme() {
            if (!temperatureChart) return;
            
            temperatureChart.options.plugins.legend.labels.color = '#ffffff';
            temperatureChart.options.scales.x.ticks.color = '#ffffff';
            temperatureChart.options.scales.y.ticks.color = '#ffffff';
            temperatureChart.update();
        }

        function generateDemoTemperatureData(baseTemp) {
            return [
                baseTemp - 3,  // 6æ™‚
                baseTemp - 1,  // 9æ™‚
                baseTemp + 2,  // 12æ™‚
                baseTemp + 5,  // 15æ™‚ï¼ˆæœ€é«˜æ°—æ¸©ï¼‰
                baseTemp + 2,  // 18æ™‚
                baseTemp - 1,  // 21æ™‚
                baseTemp - 2   // 24æ™‚
            ];
        }

        // ===== MAIN WEATHER FUNCTIONS =====
        function searchWeather() {
            const city = document.getElementById('cityInput').value.trim();
            if (!city) {
                showNotification('éƒ½å¸‚åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'warning');
                return;
            }

            showLoading();
            
            if (DEMO_MODE) {
                setTimeout(() => {
                    const cityKey = city.toLowerCase().includes('tokyo') || city.toLowerCase().includes('æ±äº¬') ? 'tokyo' :
                                  city.toLowerCase().includes('osaka') || city.toLowerCase().includes('å¤§é˜ª') ? 'osaka' :
                                  city.toLowerCase().includes('london') || city.toLowerCase().includes('ãƒ­ãƒ³ãƒ‰ãƒ³') ? 'london' :
                                  city.toLowerCase().includes('new york') || city.toLowerCase().includes('ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯') ? 'newyork' : 'tokyo';
                    
                    const weatherData = demoData[cityKey];
                    currentWeatherData = weatherData;
                    displayWeather(weatherData);
                    displayForecast(generateDemoForecast());
                    createTemperatureChart(generateDemoTemperatureData(weatherData.temp));
                    checkWeatherAlerts(weatherData);
                    showNotification(`${weatherData.name}ã®å¤©æ°—ã‚’å–å¾—ã—ã¾ã—ãŸ`, 'info');
                }, 1000);
            }
        }

        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showNotification('ä½ç½®æƒ…å ±ãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“', 'warning');
                return;
            }

            showLoading();
            
            if (DEMO_MODE) {
                setTimeout(() => {
                    const weatherData = demoData.tokyo;
                    currentWeatherData = weatherData;
                    displayWeather(weatherData);
                    displayForecast(generateDemoForecast());
                    createTemperatureChart(generateDemoTemperatureData(weatherData.temp));
                    checkWeatherAlerts(weatherData);
                    showNotification('ç¾åœ¨åœ°ã®å¤©æ°—ã‚’å–å¾—ã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢: æ±äº¬ï¼‰', 'info');
                }, 1500);
            }
        }

        function displayWeather(data) {
            const weatherDisplay = document.getElementById('weatherDisplay');
            
            weatherDisplay.innerHTML = `
                <div class="current-weather">
                    <h2>${data.name}, ${data.country}</h2>
                    <div class="weather-icon">${data.icon}</div>
                    <div class="temperature">${data.temp}Â°C</div>
                    <p>${data.weather} - ä½“æ„Ÿæ¸©åº¦ ${data.feels_like}Â°C</p>
                    
                    <div class="weather-details">
                        <div class="detail-item">
                            <h4>ğŸ’§ æ¹¿åº¦</h4>
                            <p>${data.humidity}%</p>
                        </div>
                        <div class="detail-item">
                            <h4>ğŸ’¨ é¢¨é€Ÿ</h4>
                            <p>${data.wind_speed} m/s</p>
                        </div>
                        <div class="detail-item">
                            <h4>ğŸˆ æ°—åœ§</h4>
                            <p>${data.pressure} hPa</p>
                        </div>
                        <div class="detail-item">
                            <h4>ğŸ‘ï¸ è¦–ç•Œ</h4>
                            <p>${data.visibility} km</p>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 style="color: white; margin-bottom: 20px;">ğŸ“Š æ°—æ¸©æ¨ç§»ã‚°ãƒ©ãƒ•</h3>
                    <canvas id="temperatureChart" class="chart-canvas"></canvas>
                </div>

                <div class="card">
                    <h3 style="color: white; margin-bottom: 20px;">ğŸ“… 5æ—¥é–“ã®äºˆå ±</h3>
                    <div class="forecast-container" id="forecastDisplay"></div>
                </div>
            `;
        }

        function displayForecast(forecastData) {
            const forecastDisplay = document.getElementById('forecastDisplay');
            
            forecastDisplay.innerHTML = forecastData.map(day => `
                <div class="forecast-item">
                    <h4>${day.date}</h4>
                    <div style="font-size: 40px; margin: 10px 0;">${day.icon}</div>
                    <p>${day.weather}</p>
                    <p><strong>${day.high}Â° / ${day.low}Â°</strong></p>
                </div>
            `).join('');
        }

        function generateDemoForecast() {
            return [
                { date: 'ä»Šæ—¥', icon: 'â˜€ï¸', weather: 'æ™´ã‚Œ', high: 22, low: 15 },
                { date: 'æ˜æ—¥', icon: 'â›…', weather: 'æ›‡ã‚Šæ™‚ã€…æ™´ã‚Œ', high: 20, low: 13 },
                { date: '9/2', icon: 'ğŸŒ§ï¸', weather: 'é›¨', high: 18, low: 11 },
                { date: '9/3', icon: 'â›ˆï¸', weather: 'é›·é›¨', high: 16, low: 9 },
                { date: '9/4', icon: 'â˜€ï¸', weather: 'æ™´ã‚Œ', high: 24, low: 16 }
            ];
        }

        function showLoading() {
            document.getElementById('weatherDisplay').innerHTML = `
                <div class="loading">
                    <p>ğŸ”„ å¤©æ°—æƒ…å ±ã‚’å–å¾—ä¸­...</p>
                </div>
            `;
        }

        function showError(message) {
            document.getElementById('weatherDisplay').innerHTML = `
                <div class="error">
                    <p>âŒ ${message}</p>
                </div>
            `;
        }

        // ===== INITIALIZATION =====
        window.addEventListener('load', () => {
            // Load saved theme
            const savedTheme = localStorage.getItem('darkMode');
            if (savedTheme === 'true') {
                isDarkMode = true;
                document.body.classList.add('dark-mode');
                document.querySelector('.theme-toggle').textContent = 'â˜€ï¸ ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰';
            }

            // Load favorites
            loadFavorites();

            // Initialize with demo data
            const weatherData = demoData.tokyo;
            currentWeatherData = weatherData;
            displayWeather(weatherData);
            displayForecast(generateDemoForecast());
            
            // Wait for DOM to be ready for chart
            setTimeout(() => {
                createTemperatureChart(generateDemoTemperatureData(weatherData.temp));
            }, 100);

            // Request notification permission
            if (Notification.permission === 'default') {
                showNotification('é€šçŸ¥ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨å¤©æ°—ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å—ã‘å–ã‚Œã¾ã™', 'info');
                setTimeout(() => {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            showNotification('é€šçŸ¥ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ', 'info');
                        }
                    });
                }, 2000);
            }

            console.log('ğŸŒ¤ï¸ Enhanced Weather App - All Features Loaded');
            console.log('ğŸ¯ Features: Dark Mode, Favorites, Charts, Notifications');
        });

        // Enter key support
        document.addEventListener('DOMContentLoaded', () => {
            const cityInput = document.getElementById('cityInput');
            if (cityInput) {
                cityInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchWeather();
                    }
                });
            }
        });

        // Real API functions (for when API key is configured)
        async function fetchWeatherData(city) {
            if (DEMO_MODE) return;
            
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric&lang=ja`
                );
                
                if (!response.ok) {
                    throw new Error('éƒ½å¸‚ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                const data = await response.json();
                displayWeatherFromAPI(data);
                fetchForecastData(data.coord.lat, data.coord.lon);
                
            } catch (error) {
                showError(error.message);
            }
        }

        async function fetchWeatherByCoords(lat, lon) {
            if (DEMO_MODE) return;
            
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=ja`
                );
                
                const data = await response.json();
                displayWeatherFromAPI(data);
                fetchForecastData(lat, lon);
                
            } catch (error) {
                showError('å¤©æ°—æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        }

        function displayWeatherFromAPI(data) {
            const weatherIcons = {
                'clear': 'â˜€ï¸', 'clouds': 'â›…', 'rain': 'ğŸŒ§ï¸', 'drizzle': 'ğŸŒ¦ï¸',
                'thunderstorm': 'â›ˆï¸', 'snow': 'â„ï¸', 'mist': 'ğŸŒ«ï¸'
            };

            const weatherData = {
                name: data.name,
                country: data.sys.country,
                temp: Math.round(data.main.temp),
                feels_like: Math.round(data.main.feels_like),
                humidity: data.main.humidity,
                wind_speed: data.wind.speed,
                pressure: data.main.pressure,
                visibility: Math.round(data.visibility / 1000),
                weather: data.weather[0].description,
                icon: weatherIcons[data.weather[0].main.toLowerCase()] || 'ğŸŒ¤ï¸'
            };
            
            currentWeatherData = weatherData;
            displayWeather(weatherData);
            createTemperatureChart(generateDemoTemperatureData(weatherData.temp));
            checkWeatherAlerts(weatherData);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'k':
                        e.preventDefault();
                        document.getElementById('cityInput').focus();
                        break;
                    case 'd':
                        e.preventDefault();
                        toggleTheme();
                        break;
                    case 'l':
                        e.preventDefault();
                        getCurrentLocation();
                        break;
                }
            }
        });
    </script>
</body>
</html>